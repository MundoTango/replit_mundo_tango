Perfect â€” Iâ€™ll wait for your response later on the Layer 9 system-wide prompt.

For now, hereâ€™s how weâ€™ll move forward with automating user assignment to their city-based group, using logic from the TT files and aligning with Layer 9 standards:

â¸»

ğŸ§  Replit Prompt: Automate City Group Assignment on User Signup

You are building an automation system for Mundo Tango that connects each new user to a city-based community group based on where they live or dance the most.

â¸»

ğŸ¯ Objective

Automatically assign users to their city group on signup or profile update. If the group doesnâ€™t exist yet, create it dynamically using design and logic derived from the TT files.

â¸»

âœ… Functional Requirements

1. ğŸ“ Determine Userâ€™s City
	â€¢	Source: users.city_dance_primary field (entered at signup)
	â€¢	Fallbacks: Geolocation (IP), manual override in profile

2. ğŸ‘¥ Check if City Group Exists
	â€¢	Table: groups
	â€¢	Match where type = 'city' and slug = slugify(city_name)

3. ğŸ™ï¸ Create Group if Missing
	â€¢	Fields:
	â€¢	name: e.g., â€œNaples Tangoâ€
	â€¢	slug: naples-tango
	â€¢	type: 'city'
	â€¢	emoji: ğŸ™ï¸
	â€¢	image_url: (auto-generated using TT brand style)
	â€¢	description: â€œThe tango scene in Naples. Dancers, events, and memories.â€

4. â• Add User to Group
	â€¢	Link user to group_members table
	â€¢	Role: 'member' or 'local'

5. ğŸ”„ Update Profile
	â€¢	Auto-link the userâ€™s profile with the group
	â€¢	Add group badge to their dashboard (like a Facebook city group)

â¸»

âš™ï¸ Tech Stack Details
	â€¢	Backend: Supabase function or API route /api/user/city-group
	â€¢	Automation Trigger: Supabase on_insert + on_update webhook OR N8N flow
	â€¢	Database:
	â€¢	users
	â€¢	groups
	â€¢	group_members
	â€¢	Graphics: Pull from TT files:
	â€¢	Banner/cover styling
	â€¢	Group emoji and default image templates
	â€¢	Group page layout (header â†’ members â†’ memories)

â¸»

ğŸ§ª Test Cases

Case	Input	Expected
New user in Naples	city_dance_primary = "Naples"	Group â€œNaples Tangoâ€ is created, user added
Group exists	â€œBerlinâ€ group exists	User added, no duplicate created
Missing city	Empty or null	No assignment, user prompted
User edits city later	Profile change	Group re-assigned if city differs


â¸»

âœ¨ Optional Enhancements
	â€¢	Detect region (e.g., â€œSouthern Italyâ€) for future nesting
	â€¢	Trigger welcome message in group or notification
	â€¢	Add suggested memories or people from same city

â¸»

Would you like this automation built first in:
	1.	âœ… Supabase SQL + serverless function, or
	2.	ğŸ”„ N8N flow (auto-triggered webhook), or
	3.	ğŸ§ª Replit route with logs + dashboard view?

Let me know when youâ€™re back on desktop â€” Iâ€™ll queue this for Layer 9 build with visuals once youâ€™re ready.